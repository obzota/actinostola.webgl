<!DOCTYPE html>
<html>
<head>
	<title>First webgl</title>
<!-- CSS -->
	<style type="text/css" src="styles/main.css"></style>

	<!-- Mesh Shader
		implements Phong Illumination Model -->
	<script type="x-shader/x-fragment" id='frag_shader'>
		precision mediump float;

		uniform vec3 u_PositionEye;
		uniform vec3 u_PositionLux;

		varying vec4 v_Color;
		varying vec3 v_Normal;
		varying vec3 v_Position;

		void main(void) {
			vec3 posLux = vec3(0, 0, 10);
			vec3 posEye = vec3(10, 10, 10);

			vec3 L = normalize(posLux - v_Position);
			vec3 V = normalize(posEye - v_Position);
			vec3 N = normalize(v_Normal);
			vec3 R = 2.0 * dot(N, L) * N - L;

			vec3 ia = vec3(1.0, 1.0, 1.0) * 0.30;
			vec3 id = vec3(1.0, 1.0, 1.0) * 0.45;
			vec3 is = vec3(1.0, 1.0, 1.0) * 0.5;

			float lambertian = max(dot(L,N), 0.0);
			float specular = 0.0;
			if (lambertian > 0.0) {
				specular = pow(max(0.0, dot(V,R)), 27.0);
			}
			vec3 color = ia + lambertian * id + specular * is;

			gl_FragColor = v_Color * vec4(color, 1.0);
			gl_FragColor = vec4(1.0, 1.0, 1.0, 1.0);
		}
	</script>
	<script type="x-shader/x-vertex" id='vert_shader'>
		attribute vec3 a_Position;
		attribute vec3 a_Normal;

		uniform vec4 u_Color;
		uniform mat4 u_Projection;
		uniform mat4 u_Camera;

		varying vec4 v_Color;
		varying vec3 v_Normal;
		varying vec3 v_Position;

		void main(void) {
			gl_Position = u_Projection * u_Camera * vec4(a_Position, 1.0);
			v_Color = u_Color;
			v_Normal = a_Normal;
			v_Position = a_Position;
		}
	</script>

	<!-- Line Shaders
		used to render the bÃ©zier curves
		add a color gradient -->
	<script type="x-shader/x-vertex" id="line_vertex_shader">
		attribute vec3 a_Position;
		attribute float a_Index;

		uniform mat4 u_Projection;
		uniform mat4 u_Camera;

		uniform float u_MaxIndex;
		uniform float u_Depth;
		uniform vec3 u_Color_Origin;
		uniform vec3 u_Color_Dest;

		varying vec4 v_Color;

		void main(void) {
			gl_Position = u_Projection * u_Camera * vec4(a_Position, 1.0);
			float ratio = a_Index / u_MaxIndex;
			vec3 tmp_Color = u_Color_Dest * (ratio) + u_Color_Origin * (1.0-ratio);
			tmp_Color = (tmp_Color * 0.9 * (1.0-ratio) + vec3(1.0, 1.0, 1.0) * 0.1);
			v_Color = vec4(tmp_Color, 1.0);
		}
	</script>
	<script type="x-shader/x-fragment" id="line_fragment_shader">
		precision mediump float;

		varying vec4 v_Color;

		void main(void) {
			gl_FragColor = v_Color;
		}
	</script>

	<!-- Cloud Shaders
		render cloud of particles -->
	<script type="x-shader/x-vertex" id="cloud_vertex_shader">
		uniform float u_Time;
		uniform float u_Radius;
		uniform vec3 u_Position;
		uniform vec4 u_Color;

		uniform mat4 u_Projection;
		uniform mat4 u_Camera;

		uniform bool u_Focus;

		attribute float a_Delay;
		attribute float a_Size;

		varying vec4 v_Color;

		const vec3 c_First = vec3(sqrt(5.0), sqrt(3.0), sqrt(2.0));
		const vec3 c_Second = vec3(sqrt(7.0), sqrt(13.0), sqrt(11.0));

		void main(void) {

			if (!u_Focus) {
				gl_PointSize = 1.0;
			} else {
				gl_PointSize = a_Size;
			}

			vec3 delta_pos = sin(c_First * ( u_Time / sqrt(a_Size) / u_Radius + a_Delay));
			delta_pos += cos(c_Second * ( u_Time / sqrt(a_Size) / u_Radius + a_Delay));
			delta_pos *= u_Radius / 3.0;

			gl_Position = u_Projection * u_Camera * vec4(u_Position + delta_pos, 1.0);
			v_Color = vec4(normalize(delta_pos)*0.5+0.5, 1.0);

		}
	</script>
	<script type="x-shader/x-fragment" id="cloud_fragment_shader">
		precision mediump float;

		varying vec4 v_Color;

		void main(void) {
			gl_FragColor = v_Color;
		}
	</script>

<!-- Point Shader
	"Simpliest shader ever" -->
	<script type="x-shader/x-vertex" id="point_vertex_shader">
		uniform vec3 u_Position;
		uniform vec4 u_Color;

		uniform mat4 u_Projection;
		uniform mat4 u_Camera;

		varying vec4 v_Color;

		void main(void) {
			v_Color = u_Color;

			gl_Position = u_Projection * u_Camera * vec4(u_Position, 1.0);
		}
	</script>
	<script type="x-shader/x-fragment" id="point_fragment_shader">
		precision mediump float;

		varying vec4 v_Color;

		void main(void) {
			gl_FragColor = vec4( vec3(0.0, 1.0, 0.0) , 1.0);
		}
	</script>
</head>
<body onload="main()" onresize="resize()" style="margin:0px; overflow:hidden">
	<canvas id="glcanvas">
		Your browser doesn't appear to support the HTML5 <code>&lt;canvas&gt;</code> element.
	</canvas>
<!-- External library -->
	<script type="text/javascript" src="js/lib/gl-matrix-min.js"></script>
	<script type="text/javascript" src="js/lib/bezier.js"></script>

<!-- Owned files -->
	<script src="js/camera_and_projection.js" type='text/javascript'></script>
	<script src="js/program_setup.js" type='text/javascript'></script>
	<script src="js/main.js" type='text/javascript'></script>
	<script src="js/object_builder.js" type='text/javascript'></script>
	<script src="js/drawers.js" type='text/javascript'></script>

	<script src="js/color_generator.js" type='text/javascript'></script>
	<script src="js/line_generator.js" type='text/javascript'></script>
	<script src="js/point_generator.js" type='text/javascript'></script>

	<script src="js/events.js" type='text/javascript'></script>
	<script src="js/tree_builder.js" type='text/javascript'></script>



<!-- json data as JS-->
	<script src="js/data.js" type='text/javascript'></script>

<!-- Objects generated from .obj files -->
	<script src="objects/icosphere.js" type='text/javascript'></script>
	<script src="objects/cube.js" type='text/javascript'></script>
	<script src="objects/torus.js" type='text/javascript'></script>
	<script src="objects/sphere.js" type='text/javascript'></script>

</body>
</html>
